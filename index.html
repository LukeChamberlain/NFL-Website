<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search API</title>
    <link rel="stylesheet" href="index.css">
    <script>

        function allowDrop(ev) {
            ev.preventDefault();
        }
        
        function drag(ev) {
            ev.dataTransfer.setData("text/html", ev.target.outerHTML);
        }
        
        function drop(ev, boxNumber) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text/html");
            document.querySelector(`#tradeBox${boxNumber} .trade-players`).innerHTML += data;
        }

        async function redeployServer() {
            const apiUrl = "https://api.render.com/deploy/srv-d28f8tre5dus73d73450?key=xhZ_1bBYPf8";
            try {
                const response = await fetch(apiUrl, { method: "POST" });
                if (!response.ok) {
                    console.error("Failed to redeploy server:", response.statusText);
                } else {
                    console.log("Server redeployed successfully.");
                }
            } catch (error) {
                console.error("Error redeploying server:", error.message);
            }
        }
        window.onload = redeployServer;
        function onTeamSelect(teamNumber) {
            const dropdownId = `teamDropdown${teamNumber}`;
            const selectedTeam = document.getElementById(dropdownId).value;
            if (selectedTeam) {
                fetchTeamRoster(selectedTeam, teamNumber);
            }
        }
        
        async function fetchTeamRoster(teamName, teamNumber) {
            const apiUrl = `https://nfl-website.onrender.com/proxy?team=${encodeURIComponent(teamName)}`;
            const resultsDiv = document.getElementById(`results${teamNumber}`);
            const defaultHeadshot = "default-headshot.png";
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error('Roster not found or API error');
                }
                const data = await response.json();
        
                const rosterHtml = data.teams[0].roster.map(player => {
                    const headshotUrl = player.headshot && player.headshot.includes('{format}')
                        ? player.headshot.replace('{format}', 'f_auto,q_auto')
                        : defaultHeadshot;
        
                    const name = player.name || "N/A";
                    const position = player.position || "N/A";
                    const age = player.age !== undefined && player.age !== null ? player.age : "N/A";
        
                    return `
                        <div class="roster-item" draggable="true" ondragstart="drag(event)">
                            <img src="${headshotUrl}" alt="${name}">
                            <div>
                                <p><strong>${name}</strong> (${position})</p>
                                <p>Age: ${age}</p>
                            </div>
                        </div>
                    `;
                }).join('');
        
                resultsDiv.innerHTML = `
                    <h2>${teamName} Roster</h2>
                    ${rosterHtml}
                `;
            } catch (error) {
                resultsDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }        
    </script>
</head>
<body>
    <div class="banner">
        <h1>Welcome to the demo of my NFL trade website</h1>
        <p>This website is currently underconstruction</p>
    </div>
    <h1>Search NFL Teams</h1>
    <div class="team-compare-container">
        <div class="team-panel">
            <h2>Team 1</h2>
            <label for="teamDropdown1">Select a team:</label>
            <select id="teamDropdown1" onchange="onTeamSelect(1)">
                <option value="">--Select a team--</option>
                <option value="Arizona Cardinals">Arizona Cardinals</option>
                <option value="Atlanta Falcons">Atlanta Falcons</option>
                <option value="Baltimore Ravens">Baltimore Ravens</option>
                <option value="Buffalo Bills">Buffalo Bills</option>
                <option value="Carolina Panthers">Carolina Panthers</option>
                <option value="Chicago Bears">Chicago Bears</option>
                <option value="Cincinnati Bengals">Cincinnati Bengals</option>
                <option value="Cleveland Browns">Cleveland Browns</option>
                <option value="Dallas Cowboys">Dallas Cowboys</option>
                <option value="Denver Broncos">Denver Broncos</option>
                <option value="Detroit Lions">Detroit Lions</option>
                <option value="Green Bay Packers">Green Bay Packers</option>
                <option value="Houston Texans">Houston Texans</option>
                <option value="Indianapolis Colts">Indianapolis Colts</option>
                <option value="Jacksonville Jaguars">Jacksonville Jaguars</option>
                <option value="Kansas City Chiefs">Kansas City Chiefs</option>
                <option value="Las Vegas Raiders">Las Vegas Raiders</option>
                <option value="Los Angeles Chargers">Los Angeles Chargers</option>
                <option value="Los Angeles Rams">Los Angeles Rams</option>
                <option value="Miami Dolphins">Miami Dolphins</option>
                <option value="Minnesota Vikings">Minnesota Vikings</option>
                <option value="New England Patriots">New England Patriots</option>
                <option value="New Orleans Saints">New Orleans Saints</option>
                <option value="New York Giants">New York Giants</option>
                <option value="New York Jets">New York Jets</option>
                <option value="Philadelphia Eagles">Philadelphia Eagles</option>
                <option value="Pittsburgh Steelers">Pittsburgh Steelers</option>
                <option value="San Francisco 49ers">San Francisco 49ers</option>
                <option value="Seattle Seahawks">Seattle Seahawks</option>
                <option value="Tampa Bay Buccaneers">Tampa Bay Buccaneers</option>
                <option value="Tennessee Titans">Tennessee Titans</option>
                <option value="Washington Commanders">Washington Commanders</option>
            </select>
            <div id="results1"></div>
        </div>
        <div class="trade-boxes-container">
            <div id="tradeBox1" class="trade-box" ondrop="drop(event, 1)" ondragover="allowDrop(event)">
                <h3>Trade Box 1</h3>
                <div class="trade-players"></div>
            </div>
            <div id="tradeBox2" class="trade-box" ondrop="drop(event, 2)" ondragover="allowDrop(event)">
                <h3>Trade Box 2</h3>
                <div class="trade-players"></div>
            </div>
        </div>
        <div class="team-panel">
            <h2>Team 2</h2>
            <label for="teamDropdown2">Select a team:</label>
            <select id="teamDropdown2" onchange="onTeamSelect(2)">
                <option value="">--Select a team--</option>
                <option value="Arizona Cardinals">Arizona Cardinals</option>
                <option value="Atlanta Falcons">Atlanta Falcons</option>
                <option value="Baltimore Ravens">Baltimore Ravens</option>
                <option value="Buffalo Bills">Buffalo Bills</option>
                <option value="Carolina Panthers">Carolina Panthers</option>
                <option value="Chicago Bears">Chicago Bears</option>
                <option value="Cincinnati Bengals">Cincinnati Bengals</option>
                <option value="Cleveland Browns">Cleveland Browns</option>
                <option value="Dallas Cowboys">Dallas Cowboys</option>
                <option value="Denver Broncos">Denver Broncos</option>
                <option value="Detroit Lions">Detroit Lions</option>
                <option value="Green Bay Packers">Green Bay Packers</option>
                <option value="Houston Texans">Houston Texans</option>
                <option value="Indianapolis Colts">Indianapolis Colts</option>
                <option value="Jacksonville Jaguars">Jacksonville Jaguars</option>
                <option value="Kansas City Chiefs">Kansas City Chiefs</option>
                <option value="Las Vegas Raiders">Las Vegas Raiders</option>
                <option value="Los Angeles Chargers">Los Angeles Chargers</option>
                <option value="Los Angeles Rams">Los Angeles Rams</option>
                <option value="Miami Dolphins">Miami Dolphins</option>
                <option value="Minnesota Vikings">Minnesota Vikings</option>
                <option value="New England Patriots">New England Patriots</option>
                <option value="New Orleans Saints">New Orleans Saints</option>
                <option value="New York Giants">New York Giants</option>
                <option value="New York Jets">New York Jets</option>
                <option value="Philadelphia Eagles">Philadelphia Eagles</option>
                <option value="Pittsburgh Steelers">Pittsburgh Steelers</option>
                <option value="San Francisco 49ers">San Francisco 49ers</option>
                <option value="Seattle Seahawks">Seattle Seahawks</option>
                <option value="Tampa Bay Buccaneers">Tampa Bay Buccaneers</option>
                <option value="Tennessee Titans">Tennessee Titans</option>
                <option value="Washington Commanders">Washington Commanders</option>
            </select>
            <div id="results2"></div>
        </div>
        
</body>
</html>